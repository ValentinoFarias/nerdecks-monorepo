{% load static %}

<!doctype html>
<html lang="en">
	<head>
		<!-- Basic metadata, page title and CSS includes -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>NerDecks - Your decks</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,100..900&family=Space+Grotesk:wght@300..700&display=swap"
			rel="stylesheet"
		>
		<!-- Bootstrap CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
			rel="stylesheet"
			integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
			crossorigin="anonymous"
		>
		<!-- Favicons -->
		<link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/favicons/apple-touch-icon.png' %}">
		<link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicons/favicon-32x32.png' %}">
		<link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicons/favicon-16x16.png' %}">
		<link rel="shortcut icon" href="{% static 'images/favicons/favicon.ico' %}" type="image/x-icon">
		<link rel="manifest" href="{% static 'images/favicons/site.webmanifest' %}">
		<!-- CSS Style	-->
		<link rel="stylesheet" href="{% static 'css/style.css' %}?v=20260217-1">
	</head>
	<body class="d-flex flex-column min-vh-100 bg-light">
		<!-- Top navigation bar -->
		<header class="home-header py-3">
			<div class="container">
				<nav class="home-navbar" aria-label="Site navigation">
					<a href="{% url 'home' %}" class="home-brand" aria-label="Nerdecks home">
						<img
							src="{% static 'images/newlogonerdecks.png' %}"
							alt="Nerdecks logo"
							class="home-brand-logo"
						>
					</a>
					<div class="home-navbar-actions">
						<a href="{% url 'home' %}" class="btn btn-primary scramble-text">Home</a>
						<a href="{% url 'logout' %}" class="btn btn-outline-secondary">Log out</a>
					</div>
				</nav>
			</div>
		</header>

		<!-- Main content: list of user's decks and actions -->
		<main class="flex-grow-1 py-5">
			<div class="container">
				<!-- Flash messages (success, error, etc.) -->
				{% if messages %}
					<div class="mb-3">
						{% for message in messages %}
							<div class="alert alert-{{ message.tags|default:'info' }}" role="alert">
								{{ message }}
							</div>
						{% endfor %}
					</div>
				{% endif %}
				<h1 class="h3 mb-3 your-decks">YOUR NERDECKS</h1>
				<!-- Form to create a new deck; JS fills hidden title field -->
				<div class="text-center mb-4">
					<form id="create-deck-form" method="post" action="{% url 'create_deck' %}" class="d-inline">
						{% csrf_token %}
						<input type="hidden" name="title" id="deck-title-input">
						<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createDeckModal">
  Create a NerDeck
</button>

					</form>
					<!-- Create Deck Modal: prompts user for new deck title -->
					 <div class="modal fade" id="createDeckModal" tabindex="-1" aria-labelledby="createDeckModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="createDeckModalLabel">Create a NerDeck</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <label for="newDeckNameInput" class="form-label">NerDeck name</label>
        <input id="newDeckNameInput" type="text" class="form-control" maxlength="255" placeholder="e.g. Biology - Chapter 1">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="confirmCreateDeckBtn">Create</button>
      </div>
    </div>
  </div>
</div>
				</div>
					<!-- Table listing all decks with counts for due and total cards -->
					<div class="row justify-content-center">
						<div class="col-lg-10">
							<div class="d-none d-md-block">
								<div class="table-responsive deck-table-wrap">
									<table class="table table-hover align-middle deck-table">
								<thead>
									<tr>
										<th scope="col">NerDecks</th>
										<th scope="col">Due today</th>
										<th scope="col">Total</th>
										<th scope="col">Folder</th>
										<th scope="col">Status</th>
										<th scope="col">Flashcards</th>
									</tr>
								</thead>
								<tbody>
									{% if decks %}
										{% for group in folder_groups %}
											<tr
												class="folder-row"
												draggable="true"
												data-drag-type="folder"
												data-folder-id="{{ group.folder.id }}"
											>
												<td>
													<div class="d-flex align-items-center gap-2">
														<button
															type="button"
															class="folder-toggle btn btn-sm btn-link text-decoration-none p-0"
															data-folder-id="{{ group.folder.id }}"
															aria-expanded="false"
															aria-label="Toggle folder decks"
														>
															<span class="folder-arrow">â–¶</span>
														</button>
														<form
															method="post"
															action="{% url 'rename_folder' %}"
															class="folder-rename-form mb-0"
														>
															{% csrf_token %}
															<input type="hidden" name="folder_id" value="{{ group.folder.id }}">
															<span
																class="folder-name folder-name-display"
																role="button"
																tabindex="0"
																title="Click to rename folder"
															>
																{{ group.folder.name }}
															</span>
															<input
																type="text"
																name="name"
																class="form-control form-control-sm folder-name-input d-none"
																value="{{ group.folder.name }}"
																maxlength="255"
																aria-label="Rename folder"
															>
														</form>
													</div>
												</td>
												<td class="text-muted">-</td>
												<td class="text-muted">-</td>
												<td class="text-muted">Folder</td>
												<td class="text-muted">-</td>
												<td class="text-muted">-</td>
											</tr>
											{% for deck in group.decks %}
												<tr
													class="deck-row d-none"
													draggable="true"
													data-drag-type="deck"
													data-deck-id="{{ deck.id }}"
													data-folder-id="{{ group.folder.id }}"
												>
													<td>
														<div class="d-flex align-items-center gap-2 ps-4">
															<div class="form-check mb-0">
																<input
																	class="form-check-input deck-radio"
																	type="radio"
																	name="selected_deck"
																	id="deck-{{ deck.id }}"
																	value="{{ deck.id }}"
																>
															</div>
															<form
																method="post"
																action="{% url 'rename_deck' %}"
																class="deck-rename-form mb-0"
															>
																{% csrf_token %}
																<input type="hidden" name="deck_id" value="{{ deck.id }}">
																<span
																	class="deck-name deck-name-display"
																	role="button"
																	tabindex="0"
																	title="Click to rename"
																>
																	{{ deck.title }}
																</span>
																<input
																	type="text"
																	name="title"
																	class="form-control form-control-sm deck-name-input d-none"
																	value="{{ deck.title }}"
																	maxlength="255"
																	aria-label="Rename NerDeck"
																>
															</form>
														</div>
													</td>
													<td class="{% if deck.today_cards %}text-danger fw-semibold{% else %}text-muted{% endif %} deck-count">{{ deck.today_cards|default:0 }}</td>
													<td class="text-muted deck-count">{{ deck.total_cards|default:0 }}</td>
													<td class="text-muted">
														<span class="badge text-bg-light border deck-folder-badge">{{ group.folder.name }}</span>
													</td>
													<td>
														<a
															href="{% url 'study' deck.id %}"
															class="btn btn-sm btn-success study-button deck-action-btn d-none"
															data-deck-id="{{ deck.id }}"
														>
															Study
														</a>
													</td>
													<td>
														<a
															href="{% url 'new_flashcard' deck.id %}"
															class="btn btn-sm btn-warning add-flashcard-button deck-action-btn d-none"
															data-deck-id="{{ deck.id }}"
														>
															Add
														</a>
													</td>
												</tr>
											{% endfor %}
										{% endfor %}
										{% for deck in ungrouped_decks %}
											<tr
												class="deck-row"
												draggable="true"
												data-drag-type="deck"
												data-deck-id="{{ deck.id }}"
											>
												<td>
													<div class="d-flex align-items-center gap-2">
														<div class="form-check mb-0">
															<input
																class="form-check-input deck-radio"
																type="radio"
																name="selected_deck"
																id="deck-{{ deck.id }}"
																value="{{ deck.id }}"
															>
														</div>
														<form
															method="post"
															action="{% url 'rename_deck' %}"
															class="deck-rename-form mb-0"
														>
															{% csrf_token %}
															<input type="hidden" name="deck_id" value="{{ deck.id }}">
															<span
																class="deck-name deck-name-display"
																role="button"
																tabindex="0"
																title="Click to rename"
															>
																{{ deck.title }}
															</span>
															<input
																type="text"
																name="title"
																class="form-control form-control-sm deck-name-input d-none"
																value="{{ deck.title }}"
																maxlength="255"
																aria-label="Rename NerDeck"
															>
														</form>
													</div>
												</td>
												<td class="{% if deck.today_cards %}text-danger fw-semibold{% else %}text-muted{% endif %} deck-count">{{ deck.today_cards|default:0 }}</td>
												<td class="text-muted deck-count">{{ deck.total_cards|default:0 }}</td>
												<td class="text-muted">-</td>
												<td>
													<a
														href="{% url 'study' deck.id %}"
														class="btn btn-sm btn-success study-button deck-action-btn d-none"
														data-deck-id="{{ deck.id }}"
													>
														Study
													</a>
												</td>
												<td>
													<a
														href="{% url 'new_flashcard' deck.id %}"
														class="btn btn-sm btn-warning add-flashcard-button deck-action-btn d-none"
														data-deck-id="{{ deck.id }}"
													>
														Add
													</a>
												</td>
											</tr>
										{% endfor %}
									{% else %}
										<tr>
											<td class="text-muted">No decks yet</td>
											<td class="text-muted">0</td>
											<td class="text-muted">0</td>
											<td class="text-muted">-</td>
											<td class="text-muted">-</td>
											<td class="text-muted">-</td>
										</tr>
									{% endif %}
									<tr class="root-drop-zone" data-drop-root="true">
										<td colspan="6" class="text-muted">
											Drop here to ungroup this NerDeck
										</td>
									</tr>
									</tbody>
										</table>
									</div>
									<div class="d-flex justify-content-end mt-3">
										<div class="deck-postit-note">
											<p class="mb-0">Drag and Drop two NerDecks to create a folder!</p>
										</div>
									</div>
								</div>

								<div class="d-md-none decks-mobile-wrap">
									{% if decks %}
										{% for group in folder_groups %}
											<details class="decks-mobile-folder mb-3">
												<summary class="decks-mobile-folder-summary">
													<span class="decks-mobile-folder-name">{{ group.folder.name }}</span>
													<span class="badge text-bg-light border">{{ group.decks|length }} NerDeck{{ group.decks|length|pluralize }}</span>
												</summary>
												<div class="decks-mobile-folder-content mt-2">
													{% for deck in group.decks %}
														<article class="decks-mobile-card">
															<h2 class="h6 mb-2">{{ deck.title }}</h2>
															<div class="d-flex flex-wrap gap-2 mb-3">
																<span class="badge rounded-pill text-bg-light border">Due {{ deck.today_cards|default:0 }}</span>
																<span class="badge rounded-pill text-bg-light border">Total {{ deck.total_cards|default:0 }}</span>
															</div>
															<div class="d-grid gap-2">
																<a href="{% url 'study' deck.id %}" class="btn btn-success btn-sm">Study</a>
																<a href="{% url 'new_flashcard' deck.id %}" class="btn btn-warning btn-sm">Add flashcard</a>
															</div>
														</article>
													{% endfor %}
												</div>
											</details>
										{% endfor %}

										{% if ungrouped_decks %}
											<section class="decks-mobile-ungrouped mb-3">
												<h2 class="decks-mobile-section-title">Ungrouped</h2>
												<div class="decks-mobile-folder-content mt-2">
													{% for deck in ungrouped_decks %}
														<article class="decks-mobile-card">
															<h2 class="h6 mb-2">{{ deck.title }}</h2>
															<div class="d-flex flex-wrap gap-2 mb-3">
																<span class="badge rounded-pill text-bg-light border">Due {{ deck.today_cards|default:0 }}</span>
																<span class="badge rounded-pill text-bg-light border">Total {{ deck.total_cards|default:0 }}</span>
															</div>
															<div class="d-grid gap-2">
																<a href="{% url 'study' deck.id %}" class="btn btn-success btn-sm">Study</a>
																<a href="{% url 'new_flashcard' deck.id %}" class="btn btn-warning btn-sm">Add flashcard</a>
															</div>
														</article>
													{% endfor %}
												</div>
											</section>
										{% endif %}
									{% else %}
										<div class="alert alert-light border text-center text-muted mb-0" role="status">
											No decks yet
										</div>
									{% endif %}
									<p class="text-center text-muted small mt-3 mb-0">
										Drag and drop organization is available on tablet and desktop.
									</p>
								</div>
							</div>
						</div>
				<!-- Button opens modal to delete an existing deck -->
				<div class="text-center mt-3">
					<button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteDeckModal">
						Delete a NerDeck
					</button>
				</div>
			</div>
		</main>

		<!-- Delete Deck Modal: lets the user pick and confirm a deck to delete -->
		<div class="modal fade" id="deleteDeckModal" tabindex="-1" aria-labelledby="deleteDeckModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="deleteDeckModalLabel">Delete a NerDeck</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						{% if decks %}
							<p class="mb-2">Select the NerDeck you want to delete. You will be asked to confirm.</p>
							<div class="list-group">
								{% for deck in decks %}
									<form method="post" action="{% url 'delete_deck' %}" class="mb-1" onsubmit="return confirm('Are you sure you want to delete the NerDeck &quot;{{ deck.title }}&quot;?');">
										{% csrf_token %}
										<input type="hidden" name="deck_id" value="{{ deck.id }}">
										<button type="submit" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
											<span>{{ deck.title }}</span>
										</button>
									</form>
								{% endfor %}
							</div>
						{% else %}
							<p class="mb-0 text-muted">You do not have any NerDecks to delete yet.</p>
						{% endif %}
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Simple footer with copyright -->
		<footer class="py-4 bg-white border-top mt-auto">
			<div class="container text-center text-muted small">
				&copy; NerDecks
			</div>
		</footer>

		<!-- JS: Bootstrap bundle, scramble hover effect, and page-specific logic -->
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
			crossorigin="anonymous"
		></script>
		<script src="{% static 'js/scramble_effect.js' %}"></script>
		<script src="{% static 'js/decks.js' %}?v=20260217-3"></script>
	</body>
</html>
